#!/usr/bin/env shell

###
# THIS SCRIPT IS MEANT TO BE RUN ON THE VIRTUAL MACHINE AS A SUPERUSER
###

echo Bootstraping Vagrant Box

# Set up network
echo -e "NETWORKING=yes" > /etc/sysconfig/network
echo -e "DEVICE=eth0\nBOOTPROTO=dhcp\nONBOOT=yes" > /etc/sysconfig/network-scripts/ifcfg-eth0
service network restart

# Update kernel
yum install kernel-devel
yum update kernel*
# reboot

# Install Guest Additions
mkdir /media/VirtualBoxGuestAdditions
mount -r /dev/cdrom /media/VirtualBoxGuestAdditions
rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
yum install gcc kernel-devel kernel-headers dkms make bzip2 perl
KERN_DIR=/usr/src/kernels/`uname -r`
export KERN_DIR
cd /media/VirtualBoxGuestAdditions
./VBoxLinuxAdditions.run --nox11
# reboot

# Configure sudo
#$ visudo
# then add at the end of the file:
# vagrant ALL=(ALL) NOPASSWD: ALL
echo 'vagrant ALL=(ALL:ALL) NOPASSWD: ALL' >> /etc/sudoers

# Install wget
yum install wget

# Configure insecure SSH key
cd /tpm
wget https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub
cd ~
mkdir .ssh
cp /tpm/vagrant.pub ~/.ssh/authorized_keys
chmod 0700 ~/.ssh
chmod 0600 ~/.ssh/authorized_keys

# PHP 5.5
rpm -Uvh http://mirror.webtatic.com/yum/el6/latest.rpm
yum install php55w php55w-opcache

# Ruby
yum install ruby rubygems

# Node.js
yum install nodejs npm --enablerepo=epel

# Gulp.js
npm install -g gulp